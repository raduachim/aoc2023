import { writeFileSync } from 'fs'
import {
  checkForSpecialCharacters,
  filterOutDuplicates,
  findDigitsAroundCoordinates,
  // findNumberByCoordinates,
  findNumbers,
  findSpecialCharacters,
  parseInput,
  part1,
} from '../day3'

describe.only('day3', () => {
  const input = `
    467..114..
    ...*......
    ..35..633.
    ......#...
    617*......
    .....+.58.
    ..592.....
    ......755.
    ...$.*....
    .664.598..
    `

  const matrix = parseInput(input)

  it('works to parse the input', () => {
    const expected = [
      ['4', '6', '7', '.', '.', '1', '1', '4', '.', '.'],
      ['.', '.', '.', '*', '.', '.', '.', '.', '.', '.'],
      ['.', '.', '3', '5', '.', '.', '6', '3', '3', '.'],
      ['.', '.', '.', '.', '.', '.', '#', '.', '.', '.'],
      ['6', '1', '7', '*', '.', '.', '.', '.', '.', '.'],
      ['.', '.', '.', '.', '.', '+', '.', '5', '8', '.'],
      ['.', '.', '5', '9', '2', '.', '.', '.', '.', '.'],
      ['.', '.', '.', '.', '.', '.', '7', '5', '5', '.'],
      ['.', '.', '.', '$', '.', '*', '.', '.', '.', '.'],
      ['.', '6', '6', '4', '.', '5', '9', '8', '.', '.'],
    ]

    expect(matrix).toEqual(expected)
  })

  it('works to find all numbers in a matrix', () => {
    const numbers = findNumbers(matrix)
    expect(numbers).toEqual([
      {
        number: 467,
        coordinates: [
          [0, 0],
          [0, 1],
          [0, 2],
        ],
      },
      {
        number: 114,
        coordinates: [
          [0, 5],
          [0, 6],
          [0, 7],
        ],
      },
      {
        number: 35,
        coordinates: [
          [2, 2],
          [2, 3],
        ],
      },
      {
        number: 633,
        coordinates: [
          [2, 6],
          [2, 7],
          [2, 8],
        ],
      },
      {
        number: 617,
        coordinates: [
          [4, 0],
          [4, 1],
          [4, 2],
        ],
      },
      {
        number: 58,
        coordinates: [
          [5, 7],
          [5, 8],
        ],
      },
      {
        number: 592,
        coordinates: [
          [6, 2],
          [6, 3],
          [6, 4],
        ],
      },
      {
        number: 755,
        coordinates: [
          [7, 6],
          [7, 7],
          [7, 8],
        ],
      },
      {
        number: 664,
        coordinates: [
          [9, 1],
          [9, 2],
          [9, 3],
        ],
      },
      {
        number: 598,
        coordinates: [
          [9, 5],
          [9, 6],
          [9, 7],
        ],
      },
    ])
  })
  it('works to find all special characters in a matrix', () => {
    const specialCharactersCoordinates = findSpecialCharacters(matrix)

    expect(specialCharactersCoordinates).toEqual([
      [1, 3],
      [3, 6],
      [4, 3],
      [5, 5],
      [8, 3],
      [8, 5],
    ])
  })
  it('works to find coordinates for all digits around the coordinates of a special character', () => {
    const specialCharactersCoordinates = findSpecialCharacters(matrix)
    const digitsCoordinates = findDigitsAroundCoordinates(
      matrix,
      specialCharactersCoordinates[4]
    )

    expect(digitsCoordinates).toEqual([
      [9, 2],
      [9, 3],
    ])
  })
  // it('works to find a number in a matrix by coordinates of a digit', () => {
  //   const numbers = findNumbers(matrix)
  //   const number = findNumberByCoordinates(numbers, [9, 2])

  //   expect(number).toEqual(664)
  // })

  it('works part1 for test input', () => {
    const input = `
.....613...................................439............498.........................438......617....343.............942...................
.......*............790...........269..735..*........................../679..............*444.*.........*.......147...*.............441.....
....539......422.......*......662*........*..691..........*124.15..675.................=.......404...872............237......930.....+......
........334.............861.........%....479..........424.......+.@.......402.......314...905................833........*293................
..........#.......................906.................*...............950.....................712...437.........*142.359........551.14......
....509.....=...........890...................&........9................./..847.154..568............@...102................280...*..........
.....*..950.67.............-......161.......530....=...................=............*...../..............@.......................426........
614...............................*.............59.591.....259*.......342...427..........29../.........-....................946.............
.......896........808..............6.............*.............35............./......538.....572....510...677*380...........=...............
.......*.............*534..814................879...............................615/....*............................90.........580...413...
.......810..........................................714.260..498..........386..........877......754........793...943.*............/.....*...
.....................845..#..483........55...643.......*......&.....421..+.....+...527.....938............*.......*...993...............706.
....339*..370..........-.540.@.....337..........*........39........*........404......&.......*...483...308.....567................../.......
..........*......994..............*......855..356.768.....*.....114...@195..................976....-...............496.61...610...369.200...
..........15........*...@890...447.........*.........*.303......................821..251*....................8........*....+................
...962.............260...................@..716....893..............304............*.....537.........805.....#..........................388.
............201*........................281.............471........*...../.....=....959...............%..238....180..641@...................
....278.........132..........65...&.........*920.......*.......831..97..828.....533......#368............../.......*......66-...............
.....*................*......*..627......343..........111.....*.....................................*.100$........693..........780..........
...974........474..537.759.101.......366....................183...............461*178..850.......644.........57.............................
..........67$.@.........................*...879..................54.100..355.................794.............=.....................826.530..
494*549...............670...=194.....173............329=....*14....*........*....811*303....*....891..541........975........................
........................*................403.............591................667............630....*.....$.667*....#...*......819.........19.
572...@.......%.......271..........910.........578.551..........818.534...........................217.........809.....262.....+.............
.....105.......748..............%........637...*...*........515....*...................119............*143..@.....258.......................
.20........115........714....525...491....*..768...647.....*...................433..../............583.......404..#..............268........
.......650..*.....%......%............*.311............275.283.306..=659.....................499........@................652.176............

`
    const matrix = parseInput(input)
    const numbers = findNumbers(matrix)
    console.log(
      numbers
        .filter(({ coordinates, number }) =>
          checkForSpecialCharacters(matrix, coordinates[0], number)
        )
        .map(({ number }) => number)
    )

    const result = part1(input)
    writeFileSync('day3-result.txt', result.join('\n'))
    console.log('result', result)

    expect(result).toEqual([437, 142, 551, 568, 102, 426])
  })

  it('works part1 for real input', () => {
    const result = part1().reduce((acc, number) => acc + number, 0)

    // console.log('result', result)
    // expect(result).toEqual(531318)
    expect(result).toEqual(527144)
  })
})
